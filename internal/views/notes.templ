package views 

import "main/internal/db"

import "fmt"

templ NotesListing(notes *[]db.ListNotesForUserRow) {
	<div id="note-listing" class="mt-4">
		<h1 class="text-xl">Your notes</h1>
		if len(*notes) == 0 {
			<div>You have no notes!</div>
		} else if (*notes)[0].Count > 10 {
			<div>Showing 10 of { fmt.Sprintf("%d",  (*notes)[0].Count) }</div>
		}
		<div class="flex flex-col gap-2">
			for _, item := range *notes {
				@NoteComponent(item)
			}
		</div>
	</div>
}

templ NoteComponent(item db.ListNotesForUserRow) {
	<div id={ fmt.Sprintf("noteentry-%d", item.ID) } class="shadow rounded-xl border-2 p-3 w-96">
		<div>Note Id: { fmt.Sprintf("%d", item.ID) }</div>
		<div class="prose">{ item.Content }</div>
		<div>Updated At: { item.UpdatedAt.Format("2006-01-02 3:4:5 pm") }</div>
		<div>Public? { fmt.Sprintf("%t",  item.IsPublic) }</div>
		<div>
			<span
 				hx-delete={ fmt.Sprintf("/dashboard/note/%d", item.ID) }
 				hx-push-url="true"
 				hx-swap="outerHTML"
 				hx-target="#note-listing"
 				hx-confirm="Are you sure you want to delete this note?"
			>
				@TrashIcon()
			</span>
			<span
 				hx-target={ fmt.Sprintf("#noteentry-%d", item.ID) }
 				hx-swap="outerHTML"
 				hx-get={ fmt.Sprintf("/dashboard/note/%d/edit", item.ID) }
			>
				@EditIcon()
			</span>
		</div>
	</div>
}

templ CreateNoteForm() {
	<h2>Create New Note</h2>
	<form
 		method="post"
 		action="/dashboard/note"
 		hx-target="#note-listing"
 		hx-swap="outerHTML show:no-scroll"
 		_="on htmx:afterRequest reset() me"
	>
		<textarea name="content" class="textarea textarea-bordered textarea-lg w-full" placeholder="Content for your new note!"></textarea>
		<div class="form-control ">
			<label class="label cursor-pointer">
				<span class="label-text">Make Public</span>
				<input type="checkbox" name="is_public" class="toggle toggle-primary"/>
			</label>
		</div>
		<button type="submit" class="btn btn-primary">Create</button>
	</form>
}

templ EditNoteForm(note *db.Note) {
	<form
 		hx-put={ fmt.Sprintf("/dashboard/note/%d/edit", note.ID) }
 		hx-target="this"
 		hx-swap="outerHTML"
	>
		<div class="w-96">
			<textarea name="content" class="textarea textarea-bordered textarea-lg w-full">{ note.Content }</textarea>
			<div class="form-control ">
				<label class="label cursor-pointer">
					<span class="label-text">Make Public</span>
					<input type="checkbox" checked?={ note.IsPublic } name="is_public" class="toggle toggle-primary"/>
				</label>
			</div>
			<button type="submit" class="btn btn-primary">Save</button>
			<button
 				hx-get="/dashboard"
 				hx-target="closest form"
 				hx-swap="outerHTML"
 				hx-select={ fmt.Sprintf("#noteentry-%d", note.ID) }
 				class="btn btn-primary"
			>
				Cancel
			</button>
		</div>
	</form>
}
